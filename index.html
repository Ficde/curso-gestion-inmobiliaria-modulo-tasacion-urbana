<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espacio de Repaso - FICDE</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --ficde-azul-dark: #134252;
            --ficde-azul-light: #2c5c6e;
            --ficde-naranja: #e68161;
            --ficde-naranja-hover: #ff9f85;
            --tarjeta-bg: #f0f4f5;
            --input-bg: #e2e8eb;
            --texto-principal: #0f2d38;
            --texto-secundario: #4a636e;
            --verde-exito: #2e7d32;
            --verde-bg: #c8e6c9;
            --rojo-error: #c62828;
            --naranja-bg: #ffe0b2;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--ficde-azul-dark) 0%, #0a252e 100%);
            min-height: 100vh;
            color: var(--texto-principal);
            padding: 20px;
            background-attachment: fixed;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 16px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .logo-img { height: 50px; width: auto; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }

        .module-tag {
            background: var(--ficde-naranja);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .welcome-card {
            background: var(--tarjeta-bg);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border-bottom: 6px solid var(--ficde-naranja);
            margin-bottom: 30px;
        }

        .welcome-title {
            color: var(--ficde-azul-dark);
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .fede-avatar-large {
            width: 140px; height: 140px;
            margin: 0 auto 20px;
            border-radius: 50%;
            background: var(--ficde-naranja);
            padding: 5px;
            box-shadow: 0 10px 25px rgba(230, 129, 97, 0.5);
            cursor: pointer;
            transition: transform 0.3s;
            overflow: hidden;
        }

        .fede-avatar-large:hover { transform: scale(1.1); }

        .fede-avatar-large img {
            width: 100%; height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid white;
        }

        .blocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }

        .block-card {
            background: var(--tarjeta-bg);
            padding: 30px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
        }

        .block-card:hover {
            transform: translateY(-8px);
            border-color: var(--ficde-naranja);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .block-icon {
            font-size: 3rem; margin-bottom: 15px;
            background: rgba(19, 66, 82, 0.1);
            width: 70px; height: 70px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; color: var(--ficde-azul-dark);
        }

        .block-title { color: var(--ficde-azul-dark); font-size: 1.3rem; font-weight: 700; margin-bottom: 10px; }

        .block-desc { color: var(--texto-secundario); font-size: 0.9rem; line-height: 1.5; }

        .activity-screen {
            display: none;
            grid-template-columns: 280px 1fr;
            gap: 25px;
            align-items: start;
        }

        .activity-screen.active { display: grid; }

        .tutor-sidebar {
            background: var(--ficde-azul-light);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            position: sticky; top: 20px;
        }

        .tutor-bubble {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 12px;
            font-size: 0.95rem;
            color: var(--ficde-azul-dark);
            margin-top: 20px;
            position: relative;
            text-align: left;
        }

        .tutor-bubble::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            border-width: 0 10px 10px;
            border-style: solid;
            border-color: transparent transparent rgba(255,255,255,0.95);
            transform: translateX(-50%);
        }

        .activity-content {
            background: var(--tarjeta-bg);
            padding: 40px;
            border-radius: 16px;
            min-height: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .act-badge {
            background: var(--ficde-naranja);
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .act-title { font-size: 1.8rem; color: var(--ficde-azul-dark); margin: 15px 0; font-weight: 800; }

        .act-instruction { font-size: 1.1rem; color: var(--texto-secundario); margin-bottom: 30px; }

        .student-input {
            width: 100%;
            height: 150px;
            padding: 20px;
            background: var(--input-bg);
            border: 2px solid transparent;
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            color: var(--ficde-azul-dark);
            transition: all 0.3s;
        }

        .student-input:focus { background: white; border-color: var(--ficde-naranja); outline: none; }

        .fill-input {
            border: none;
            border-bottom: 2px solid var(--ficde-naranja);
            background: transparent;
            font-weight: 700;
            color: var(--ficde-azul-dark);
            text-align: center;
            width: 150px;
            font-size: 1.1rem;
        }

        .btn-action {
            width: 100%;
            padding: 18px;
            margin-top: 30px;
            border: none;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            background: linear-gradient(90deg, var(--ficde-naranja), #ff9f85);
            color: white;
            box-shadow: 0 6px 20px rgba(230, 129, 97, 0.4);
            transition: transform 0.2s;
        }

        .btn-action:hover { transform: translateY(-3px); }

        .btn-back {
            background: transparent;
            color: var(--texto-secundario);
            box-shadow: none;
            border: 2px solid #ccc;
            margin-top: 15px;
        }

        .btn-back:hover { background: #e0e0e0; color: var(--ficde-azul-dark); }

        .traffic-row, .checklist-item {
            background: white;
            margin-bottom: 12px;
            padding: 15px 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .traffic-row:hover, .checklist-item:hover { border-color: var(--ficde-naranja); transform: translateX(5px); }

        .traffic-btn {
            width: 35px; height: 35px;
            border-radius: 50%; border: 2px solid #ddd;
            cursor: pointer;
            opacity: 0.3;
        }

        .traffic-btn.active { opacity: 1; transform: scale(1.2); border-color: var(--ficde-azul-dark); }

        .bg-green { background: #4CAF50; }

        .bg-yellow { background: #FFC107; }

        .bg-red { background: #f44336; }

        .check-box {
            width: 24px; height: 24px;
            border: 2px solid #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .checklist-item.selected { border-color: var(--ficde-naranja); background: #fff5f0; }

        .checklist-item.selected .check-box { background: var(--ficde-naranja); border-color: var(--ficde-naranja); color: white; }

        .feedback-area {
            margin-top: 30px;
            padding: 25px;
            border-radius: 12px;
            display: none;
            animation: slideUp 0.4s;
        }

        .feedback-success { background: var(--verde-bg); color: #1b5e20; border-left: 6px solid var(--verde-exito); }

        .feedback-retry { background: var(--naranja-bg); color: #bf360c; border-left: 6px solid #ef6c00; }

        .feedback-fail { background: #cfd8dc; color: #37474f; border-left: 6px solid #455a64; }

        #musicToggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--ficde-naranja);
            color: white;
            border: none;
            cursor: pointer;
            z-index: 100;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .activity-screen { grid-template-columns: 1fr; }
            .tutor-sidebar { display: flex; align-items: center; gap: 20px; }
            .fede-avatar-large { width: 80px; height: 80px; }
            .tutor-bubble::after { display: none; }
        }
    </style>
</head>

<body>
    <!-- AUDIOS MP3 -->
    <audio id="bgMusic" loop preload="auto">
        <source src="chill-study-desk-focus-concentration-lofi-451180.mp3" type="audio/mpeg">
    </audio>

    <audio id="saludoInicial" preload="auto" src="saludoinicial.mp3"></audio>
    <audio id="mensaje1Ejercicios" preload="auto" src="mensaje1ejercicios.mp3"></audio>
    <audio id="mensaje2Ejercicios" preload="auto" src="mensaje2ejercicios.mp3"></audio>
    <audio id="mensaje3Ejercicios" preload="auto" src="mensaje3ejercicios.mp3"></audio>
    <audio id="mensaje4Ejercicios" preload="auto" src="mensaje4ejercicios.mp3"></audio>
    <audio id="respuestaCorrecta" preload="auto" src="respuestacorrecta.mp3"></audio>
    <audio id="primerError" preload="auto" src="primererror.mp3"></audio>
    <audio id="segundoError" preload="auto" src="segundoerror.mp3"></audio>
    <audio id="loLograste" preload="auto" src="lolograste.mp3"></audio>

    <audio id="hoverSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.m4a"></audio>
    <audio id="clickSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.m4a"></audio>
    <audio id="successSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.m4a"></audio>

    <button id="musicToggle" onclick="toggleMusic()">üîá</button>

    <div class="container">
        <header>
            <div class="logo-container">
                <img src="logo.png" alt="FICDE" class="logo-img" onerror="this.style.display='none'; document.getElementById('altLogo').style.display='block'">
                <h2 id="altLogo" style="display:none; color:white; font-weight:800;">FICDE</h2>
            </div>
            <div class="module-tag">M√≥dulo Tasaci√≥n Urbana</div>
        </header>

        <div id="selectionScreen">
            <div class="welcome-card">
                <div class="fede-avatar-large" onclick="playAudio('saludoInicial')">
                    <img src="personaje.gif" alt="Fede">
                </div>
                <h1 class="welcome-title">Espacio de Repaso Interactivo</h1>
                <p style="color: var(--texto-secundario); font-size: 1.1rem;">Donde el conocimiento se convierte en acci√≥n</p>
            </div>

            <div class="blocks-grid">
                <div class="block-card" onclick="startModule('sintesis')">
                    <div class="block-icon">üß†</div>
                    <div class="block-title">S√≠ntesis</div>
                    <div class="block-desc">Conceptos fundamentales de tasaci√≥n urbana, finalidad, criterios y factores que intervienen en la valuaci√≥n.</div>
                </div>

                <div class="block-card" onclick="startModule('analisis')">
                    <div class="block-icon">üîç</div>
                    <div class="block-title">An√°lisis Cr√≠tico</div>
                    <div class="block-desc">An√°lisis reflexivo sobre criterios t√©cnicos, variables de mercado y fundamentos que sustentan la valuaci√≥n urbana.</div>
                </div>

                <div class="block-card" onclick="startModule('escenarios')">
                    <div class="block-icon">üé¨</div>
                    <div class="block-title">Escenarios</div>
                    <div class="block-desc">Aplicaci√≥n pr√°ctica de criterios de tasaci√≥n urbana en situaciones reales de mercado y an√°lisis profesional.</div>
                </div>

                <div class="block-card" onclick="startModule('practica')">
                    <div class="block-icon">‚ö°</div>
                    <div class="block-title">Pr√°ctica</div>
                    <div class="block-desc">Aplicaci√≥n operativa de m√©todos, criterios t√©cnicos y an√°lisis de mercado en situaciones concretas de tasaci√≥n urbana.</div>
                </div>
            </div>
        </div>

        <div id="activityScreen" class="activity-screen">
            <div class="tutor-sidebar">
                <div class="fede-avatar-large" style="width: 100px; height: 100px; border-color: var(--ficde-naranja);" onclick="replayTutorMessage()">
                    <img src="personaje.gif" alt="Fede">
                </div>
                <div style="flex:1;">
                    <h3 style="color:var(--ficde-naranja); margin-bottom:5px;">Tutor Fede</h3>
                    <div class="tutor-bubble" id="tutorMessage"></div>
                </div>
            </div>

            <div class="activity-content" id="activityContainer"></div>
        </div>
    </div>

    <script>
        // ===== GESTI√ìN DE AUDIO MP3 =====
        const audioFiles = {
            saludoInicial: document.getElementById('saludoInicial'),
            mensaje1: document.getElementById('mensaje1Ejercicios'),
            mensaje2: document.getElementById('mensaje2Ejercicios'),
            mensaje3: document.getElementById('mensaje3Ejercicios'),
            mensaje4: document.getElementById('mensaje4Ejercicios'),
            correcto: document.getElementById('respuestaCorrecta'),
            error1: document.getElementById('primerError'),
            error2: document.getElementById('segundoError'),
            lolograste: document.getElementById('loLograste')
        };

        function playAudio(audioKey) {
            if (audioFiles[audioKey]) {
                audioFiles[audioKey].currentTime = 0;
                audioFiles[audioKey].play().catch(err => console.log('Error al reproducir audio:', err));
            }
        }

        const bgMusic = document.getElementById('bgMusic');
        const clickSoundEl = document.getElementById('clickSound');
        const successSoundEl = document.getElementById('successSound');
        const hoverSoundEl = document.getElementById('hoverSound');

        let musicOn = false;
        let audioUnlocked = false;

        function unlockAudio() {
            if (audioUnlocked) return;
            Object.values(audioFiles).forEach(a => {
                a.volume = 0;
                const p = a.play();
                if (p) p.then(() => { a.pause(); a.currentTime = 0; a.volume = 1; }).catch(()=>{});
            });
            audioUnlocked = true;
        }

        document.addEventListener('pointerdown', unlockAudio, { once: true });
        document.addEventListener('keydown', unlockAudio, { once: true });

        function toggleMusic() {
            unlockAudio();
            if (!musicOn) {
                bgMusic.volume = 0.1;
                bgMusic.play().catch(() => {});
                document.getElementById('musicToggle').innerText = 'üéµ';
            } else {
                bgMusic.pause();
                document.getElementById('musicToggle').innerText = 'üîá';
            }
            musicOn = !musicOn;
        }

        function playSound(type) {
            if (!audioUnlocked) return;
            try {
                if (type === 'click') { clickSoundEl.currentTime=0; clickSoundEl.volume=0.8; clickSoundEl.play().catch(()=>{}); }
                if (type === 'success') { successSoundEl.currentTime=0; successSoundEl.volume=0.8; successSoundEl.play().catch(()=>{}); }
                if (type === 'hover') { hoverSoundEl.currentTime=0; hoverSoundEl.volume=0.2; hoverSoundEl.play().catch(()=>{}); }
            } catch (e) {}
        }

        function wireUiSounds() {
            document.querySelectorAll('.block-card, .btn-action, .checklist-item, .traffic-row, .fede-avatar-large').forEach(el => {
                if (el.dataset.sound === '1') return;
                el.dataset.sound = '1';
                el.addEventListener('mouseenter', () => playSound('hover'));
                el.addEventListener('click', () => playSound('click'));
            });
        }

        window.addEventListener('load', wireUiSounds);

        // ===== NORMALIZACI√ìN DE TEXTO =====
        function normalizar(txt) {
            return txt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        // ===== ACTIVIDADES =====
        const modules = {
            sintesis: [
                {
                    type: 'text',
                    badge: 'Concepto de tasaci√≥n urbana',
                    title: 'Finalidad de la valuaci√≥n inmobiliaria',
                    instruction: 'Explic√° qu√© es la tasaci√≥n urbana y cu√°l es su finalidad dentro del mercado inmobiliario.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('valor')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('inmueble')) c++;
                        if (v.includes('proceso')) c++;
                        if (v.includes('tecnico')) c++;
                        if (v.includes('determin')) c++;
                        if (v.includes('condicion')) c++;
                        if (v.includes('caracteristic')) c++;
                        if (v.includes('propia')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en la relaci√≥n entre inmueble y precio de mercado.',
                    explanation: 'La tasaci√≥n urbana es el proceso t√©cnico que determina el valor de un inmueble seg√∫n condiciones del mercado y caracter√≠sticas propias.'
                },
                {
                    type: 'text',
                    badge: 'Rol del tasador',
                    title: 'Funci√≥n t√©cnica en la determinaci√≥n del valor',
                    instruction: 'Describ√≠ cu√°l es la funci√≥n del tasador en la determinaci√≥n del valor de un bien urbano.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('analisis')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('estudio')) c++;
                        if (v.includes('tecnico')) c++;
                        if (v.includes('objetivo')) c++;
                        if (v.includes('fundament')) c++;
                        return c >= 2;
                    },
                    tutor: 'Consider√° que no es una opini√≥n sino un estudio t√©cnico.',
                    explanation: 'El tasador realiza un an√°lisis t√©cnico del inmueble y del mercado para determinar un valor objetivo y fundamentado.'
                },
                {
                    type: 'checklist',
                    badge: 'Factores que influyen en la tasaci√≥n',
                    title: 'Variables determinantes del valor',
                    instruction: 'Marc√° factores que influyen en la valuaci√≥n de un inmueble urbano.',
                    items: [
                        { text: 'Estado de conservaci√≥n', correct: true },
                        { text: 'Superficie', correct: true },
                        { text: 'Ubicaci√≥n', correct: true },
                        { text: 'Preferencias personales del tasador', correct: false }
                    ],
                    tutor: 'Pens√° en caracter√≠sticas objetivas del inmueble.',
                    explanation: 'La tasaci√≥n considera factores objetivos como ubicaci√≥n, superficie y estado, excluyendo criterios personales.'
                },
                {
                    type: 'text',
                    badge: 'Valor y precio',
                    title: 'Diferencia conceptual',
                    instruction: 'Explic√° la diferencia entre valor y precio en el contexto inmobiliario.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('valor')) c++;
                        if (v.includes('precio')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('resultado')) c++;
                        if (v.includes('estimado')) c++;
                        if (v.includes('monto')) c++;
                        if (v.includes('final')) c++;
                        if (v.includes('acord')) c++;
                        if (v.includes('oferta')) c++;
                        if (v.includes('demanda')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en oferta y demanda.',
                    explanation: 'El valor es el resultado t√©cnico estimado seg√∫n mercado; el precio es el monto final acordado entre oferta y demanda.'
                },
                {
                    type: 'blanks',
                    badge: 'M√©todo comparativo',
                    title: 'Referencia de mercado',
                    instruction: 'Completar la frase.<br><br>El m√©todo comparativo se basa en analizar ________ similares vendidos en el mercado.',
                    blanks: ['inmuebles'],
                    tutor: 'Pens√° en operaciones realizadas.',
                    explanation: 'El m√©todo comparativo determina valor analizando inmuebles similares en el mercado.'
                },
                {
                    type: 'text',
                    badge: 'Ubicaci√≥n como factor de valor',
                    title: 'Incidencia en la tasaci√≥n',
                    instruction: 'Explic√° por qu√© la ubicaci√≥n influye en la tasaci√≥n urbana.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('ubicacion')) c++;
                        if (v.includes('demanda')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('impact')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('urbano')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en accesibilidad y entorno.',
                    explanation: 'La ubicaci√≥n impacta en la demanda y por lo tanto en el valor del inmueble dentro del mercado urbano.'
                },
                {
                    type: 'checklist',
                    badge: 'Caracter√≠sticas f√≠sicas del inmueble',
                    title: 'Elementos observables',
                    instruction: 'Marc√° elementos f√≠sicos relevantes en una tasaci√≥n.',
                    items: [
                        { text: 'Color preferido del propietario', correct: false },
                        { text: 'Antig√ºedad', correct: true },
                        { text: 'Calidad constructiva', correct: true },
                        { text: 'Servicios disponibles', correct: true }
                    ],
                    tutor: 'Consider√° aspectos t√©cnicos verificables.',
                    explanation: 'La tasaci√≥n analiza caracter√≠sticas f√≠sicas como antig√ºedad, calidad constructiva y servicios disponibles.'
                },
                {
                    type: 'text',
                    badge: 'Mercado inmobiliario',
                    title: 'Oferta y demanda',
                    instruction: 'Explic√° c√≥mo la oferta y la demanda inciden en la tasaci√≥n urbana.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('oferta')) c++;
                        if (v.includes('demanda')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('relacion')) c++;
                        if (v.includes('influy')) c++;
                        if (v.includes('determin')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en equilibrio de precios.',
                    explanation: 'La relaci√≥n entre oferta y demanda del mercado influye directamente en la determinaci√≥n del valor del inmueble.'
                },
                {
                    type: 'traffic',
                    badge: 'Principios de objetividad',
                    title: 'Criterios en la tasaci√≥n',
                    instruction: 'Marca afirmaciones correctas sobre tasaci√≥n urbana',
                    items: [
                        { text: 'El an√°lisis del mercado es parte del proceso de tasaci√≥n.', color: 'green' },
                        { text: 'El valor depende exclusivamente de la opini√≥n del propietario.', color: 'red' },
                        { text: 'La tasaci√≥n ignora factores f√≠sicos del inmueble.', color: 'red' },
                        { text: 'La tasaci√≥n debe basarse en criterios objetivos y t√©cnicos.', color: 'green' }
                    ],
                    tutor: 'Record√° que la tasaci√≥n es un procedimiento t√©cnico.',
                    explanation: 'La tasaci√≥n urbana requiere objetividad, an√°lisis t√©cnico y estudio del mercado para determinar valor.'
                },
                {
                    type: 'text',
                    badge: 'Importancia de la tasaci√≥n',
                    title: 'Herramienta para la toma de decisiones',
                    instruction: 'Explic√° por qu√© la tasaci√≥n es fundamental para operaciones inmobiliarias.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('decision')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('brind')) c++;
                        if (v.includes('fundament')) c++;
                        if (v.includes('segura')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en seguridad en la operaci√≥n.',
                    explanation: 'La tasaci√≥n brinda un valor fundamentado que permite tomar decisiones seguras dentro del mercado inmobiliario.'
                }
            ],
            analisis: [
                {
                    type: 'text',
                    badge: 'Criterio profesional en la tasaci√≥n',
                    title: 'Fundamentaci√≥n del valor estimado',
                    instruction: 'Explic√° por qu√© el tasador debe fundamentar t√©cnicamente el valor asignado a un inmueble.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('fundamentacion')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('garantiz')) c++;
                        if (v.includes('objetiv')) c++;
                        if (v.includes('estim')) c++;
                        if (v.includes('respald')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en la necesidad de objetividad.',
                    explanation: 'La fundamentaci√≥n t√©cnica garantiza objetividad en el valor estimado y respalda la decisi√≥n frente al mercado.'
                },
                {
                    type: 'text',
                    badge: 'Subjetividad y objetividad',
                    title: 'L√≠mites en la valuaci√≥n inmobiliaria',
                    instruction: 'Explic√° por qu√© la tasaci√≥n no debe basarse en apreciaciones personales.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('objetividad')) c++;
                        if (v.includes('analisis')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('requier')) c++;
                        if (v.includes('objetiv')) c++;
                        if (v.includes('evit')) c++;
                        if (v.includes('apreciacion')) c++;
                        if (v.includes('personal')) c++;
                        if (v.includes('alter')) c++;
                        return c >= 2;
                    },
                    tutor: 'Consider√° el car√°cter t√©cnico del informe.',
                    explanation: 'La tasaci√≥n requiere an√°lisis objetivo del mercado y del inmueble, evitando apreciaciones personales que alteren el valor.'
                },
                {
                    type: 'checklist',
                    badge: 'Variables de an√°lisis',
                    title: 'Elementos comparables en el mercado',
                    instruction: 'Marc√° criterios v√°lidos al comparar inmuebles para tasar.',
                    items: [
                        { text: 'Ubicaci√≥n similar', correct: true },
                        { text: 'Superficie equivalente', correct: true },
                        { text: 'Estado constructivo comparable', correct: true },
                        { text: 'Preferencia del comprador', correct: false }
                    ],
                    tutor: 'Pens√° en similitudes objetivas.',
                    explanation: 'La comparaci√≥n exige variables objetivas como ubicaci√≥n, superficie y estado constructivo dentro del mercado.'
                },
                {
                    type: 'text',
                    badge: 'Incidencia del entorno',
                    title: 'Impacto urbano en el valor',
                    instruction: 'Explic√° c√≥mo el entorno urbano puede modificar el valor de un inmueble.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('entorno')) c++;
                        if (v.includes('demanda')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('influy')) c++;
                        if (v.includes('accesibil')) c++;
                        if (v.includes('servici')) c++;
                        if (v.includes('desarroll')) c++;
                        if (v.includes('urbano')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en accesos y servicios.',
                    explanation: 'El entorno influye en la demanda y por lo tanto en el valor, seg√∫n accesibilidad, servicios y desarrollo urbano.'
                },
                {
                    type: 'blanks',
                    badge: 'Oferta y demanda',
                    title: 'Relaci√≥n con el valor inmobiliario',
                    instruction: 'Completar la frase.<br><br>Cuando la demanda supera a la oferta, el ________ tiende a incrementarse.',
                    blanks: ['valor'],
                    tutor: 'Pens√° en equilibrio de mercado.',
                    explanation: 'En un mercado con alta demanda, el valor del inmueble suele incrementarse.'
                },
                {
                    type: 'text',
                    badge: 'M√©todo comparativo',
                    title: 'Aplicaci√≥n cr√≠tica',
                    instruction: 'Explic√° por qu√© el m√©todo comparativo requiere informaci√≥n actualizada del mercado.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('mercado')) c++;
                        if (v.includes('comparacion')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('valid')) c++;
                        if (v.includes('dat')) c++;
                        if (v.includes('actual')) c++;
                        if (v.includes('reflej')) c++;
                        if (v.includes('correct')) c++;
                        if (v.includes('real')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en operaciones recientes.',
                    explanation: 'La comparaci√≥n v√°lida exige datos actuales del mercado para reflejar correctamente el valor real del inmueble.'
                },
                {
                    type: 'checklist',
                    badge: 'Caracter√≠sticas t√©cnicas',
                    title: 'Factores determinantes del valor',
                    instruction: 'Marc√° caracter√≠sticas t√©cnicas que influyen directamente en la tasaci√≥n.',
                    items: [
                        { text: 'Calidad constructiva', correct: true },
                        { text: 'Opini√≥n del vecino', correct: false },
                        { text: 'Servicios disponibles', correct: true },
                        { text: 'Antig√ºedad', correct: true }
                    ],
                    tutor: 'Consider√° elementos verificables del inmueble.',
                    explanation: 'La tasaci√≥n se basa en caracter√≠sticas t√©cnicas objetivas como calidad, antig√ºedad y servicios.'
                },
                {
                    type: 'text',
                    badge: 'Informe de tasaci√≥n',
                    title: 'Responsabilidad profesional',
                    instruction: 'Explic√° por qu√© el informe de tasaci√≥n implica responsabilidad profesional.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('responsabilidad')) c++;
                        if (v.includes('informe')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('determin')) c++;
                        if (v.includes('impact')) c++;
                        if (v.includes('decision')) c++;
                        if (v.includes('economic')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en consecuencias econ√≥micas.',
                    explanation: 'El informe determina un valor que impacta en decisiones econ√≥micas, por lo que implica responsabilidad profesional.'
                },
                {
                    type: 'traffic',
                    badge: 'Principios del an√°lisis inmobiliario',
                    title: 'Criterios t√©cnicos en la valuaci√≥n',
                    instruction: 'Marca afirmaciones correctas sobre tasaci√≥n urbana',
                    items: [
                        { text: 'Las caracter√≠sticas f√≠sicas influyen en el valor estimado.', color: 'green' },
                        { text: 'El valor puede fijarse sin analizar oferta y demanda.', color: 'red' },
                        { text: 'La tasaci√≥n debe considerar operaciones similares del mercado.', color: 'green' },
                        { text: 'La tasaci√≥n depende exclusivamente del deseo del propietario.', color: 'red' }
                    ],
                    tutor: 'Record√° que el an√°lisis debe ser t√©cnico y objetivo.',
                    explanation: 'La tasaci√≥n urbana requiere estudio del mercado y caracter√≠sticas f√≠sicas para determinar un valor objetivo.'
                },
                {
                    type: 'text',
                    badge: 'Toma de decisiones',
                    title: 'Uso estrat√©gico de la tasaci√≥n',
                    instruction: 'Explic√° c√≥mo la tasaci√≥n urbana contribuye a una negociaci√≥n inmobiliaria.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('negociacion')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('aport')) c++;
                        if (v.includes('sirv')) c++;
                        if (v.includes('base')) c++;
                        if (v.includes('tecnic')) c++;
                        if (v.includes('negoci')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en base objetiva de acuerdo.',
                    explanation: 'La tasaci√≥n aporta un valor t√©cnico que sirve como base objetiva para negociar dentro del mercado inmobiliario.'
                }
            ],
            escenarios: [
                {
                    type: 'text',
                    badge: 'Diferencia entre valor y expectativa',
                    title: 'Ajuste del precio solicitado',
                    instruction: 'Un propietario insiste en vender su inmueble por un valor muy superior al estimado t√©cnicamente. ¬øC√≥mo deber√≠as actuar frente a esta situaci√≥n?',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('valor')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('objetividad')) c++;
                        if (v.includes('expectativa')) c++;
                        if (v.includes('diferenciandolo')) c++;
                        if (v.includes('deb')) c++;
                        if (v.includes('explic')) c++;
                        if (v.includes('tecnic')) c++;
                        if (v.includes('diferenci')) c++;
                        if (v.includes('personal')) c++;
                        if (v.includes('propietari')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en fundamentaci√≥n t√©cnica.',
                    explanation: 'Debo explicar el valor seg√∫n mercado con objetividad t√©cnica, diferenci√°ndolo de la expectativa personal del propietario.'
                },
                {
                    type: 'traffic',
                    badge: 'Conducta profesional ante presi√≥n del cliente',
                    title: 'Objetividad en la tasaci√≥n',
                    instruction: 'Marca afirmaciones correctas sobre la conducta del tasador',
                    items: [
                        { text: 'Modificar el valor para conformar al propietario es una pr√°ctica v√°lida.', color: 'red' },
                        { text: 'El valor debe fundamentarse en an√°lisis del mercado.', color: 'green' },
                        { text: 'La tasaci√≥n requiere independencia profesional.', color: 'green' },
                        { text: 'El informe puede elaborarse sin comparar inmuebles similares.', color: 'red' }
                    ],
                    tutor: 'Record√° que la objetividad es esencial en la tasaci√≥n.',
                    explanation: 'El tasador debe actuar con independencia y an√°lisis t√©cnico del mercado para determinar el valor.'
                },
                {
                    type: 'text',
                    badge: 'Influencia del entorno',
                    title: 'Impacto de cambios urbanos',
                    instruction: 'En una zona donde se inaugura un nuevo centro comercial, ¬øc√≥mo podr√≠a verse afectada la tasaci√≥n de inmuebles cercanos?',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('entorno')) c++;
                        if (v.includes('demanda')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('nuev')) c++;
                        if (v.includes('aument')) c++;
                        if (v.includes('modific')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en accesibilidad y servicios.',
                    explanation: 'El nuevo entorno puede aumentar la demanda y modificar el valor del inmueble seg√∫n el mercado urbano.'
                },
                {
                    type: 'checklist',
                    badge: 'Evaluaci√≥n comparativa',
                    title: 'Selecci√≥n de inmuebles similares',
                    instruction: 'Marc√° criterios adecuados para seleccionar inmuebles comparables.',
                    items: [
                        { text: 'Misma zona', correct: true },
                        { text: 'Barrio completamente distinto', correct: false },
                        { text: 'Superficie similar', correct: true },
                        { text: 'Condici√≥n constructiva equivalente', correct: true }
                    ],
                    tutor: 'Busc√° similitud objetiva.',
                    explanation: 'La comparaci√≥n v√°lida exige similitud en zona, superficie y estado para determinar valor real.'
                },
                {
                    type: 'text',
                    badge: 'Mercado en recesi√≥n',
                    title: 'Ajuste del valor estimado',
                    instruction: 'Si el mercado muestra baja demanda y exceso de oferta, ¬øc√≥mo incide esto en la tasaci√≥n?',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('oferta')) c++;
                        if (v.includes('demanda')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('super')) c++;
                        if (v.includes('tend')) c++;
                        if (v.includes('ajust')) c++;
                        if (v.includes('baja')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en equilibrio de mercado.',
                    explanation: 'Cuando la oferta supera la demanda, el valor tiende a ajustarse a la baja seg√∫n condiciones del mercado.'
                },
                {
                    type: 'traffic',
                    badge: 'Caracter√≠sticas f√≠sicas',
                    title: 'Incidencia en el valor',
                    instruction: 'Marca afirmaciones correctas sobre factores f√≠sicos',
                    items: [
                        { text: 'El color favorito del propietario determina el valor.', color: 'red' },
                        { text: 'La antig√ºedad puede influir en la tasaci√≥n.', color: 'green' },
                        { text: 'El estado de conservaci√≥n no afecta el valor.', color: 'red' },
                        { text: 'La calidad constructiva es un factor relevante.', color: 'green' }
                    ],
                    tutor: 'Consider√° elementos t√©cnicos verificables.',
                    explanation: 'Factores f√≠sicos como antig√ºedad y calidad constructiva influyen directamente en el valor del inmueble.'
                },
                {
                    type: 'text',
                    badge: 'Informe t√©cnico',
                    title: 'Responsabilidad ante terceros',
                    instruction: 'Si una entidad financiera utiliza tu tasaci√≥n para otorgar un cr√©dito, ¬øqu√© implica esto para tu responsabilidad profesional?',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('informe')) c++;
                        if (v.includes('responsabilidad')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('impact')) c++;
                        if (v.includes('financier')) c++;
                        if (v.includes('implic')) c++;
                        if (v.includes('profesional')) c++;
                        if (v.includes('determin')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en consecuencias econ√≥micas.',
                    explanation: 'El informe impacta en decisiones financieras, por lo que implica responsabilidad profesional sobre el valor determinado.'
                },
                {
                    type: 'checklist',
                    badge: 'Variables de mercado',
                    title: 'Elementos a considerar en la tasaci√≥n',
                    instruction: 'Marc√° variables propias del mercado inmobiliario.',
                    items: [
                        { text: 'Operaciones recientes', correct: true },
                        { text: 'Oferta disponible', correct: true },
                        { text: 'Nivel de demanda', correct: true },
                        { text: 'Preferencias personales del tasador', correct: false }
                    ],
                    tutor: 'Enfocate en datos de mercado.',
                    explanation: 'La tasaci√≥n analiza oferta, demanda y operaciones recientes para determinar valor objetivo.'
                },
                {
                    type: 'text',
                    badge: 'M√©todo comparativo',
                    title: 'Justificaci√≥n del procedimiento',
                    instruction: '¬øPor qu√© es necesario justificar las comparaciones utilizadas en una tasaci√≥n?',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('comparacion')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('justific')) c++;
                        if (v.includes('garantiz')) c++;
                        if (v.includes('transparenci')) c++;
                        if (v.includes('tecnic')) c++;
                        if (v.includes('respald')) c++;
                        if (v.includes('estim')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en transparencia t√©cnica.',
                    explanation: 'Justificar la comparaci√≥n garantiza transparencia t√©cnica y respaldo del valor estimado en el mercado.'
                },
                {
                    type: 'traffic',
                    badge: 'Principios de la tasaci√≥n urbana',
                    title: 'Criterios t√©cnicos fundamentales',
                    instruction: 'Marca afirmaciones correctas sobre tasaci√≥n',
                    items: [
                        { text: 'El valor puede fijarse sin an√°lisis t√©cnico.', color: 'red' },
                        { text: 'La tasaci√≥n es una estimaci√≥n sin fundamento.', color: 'red' },
                        { text: 'Las caracter√≠sticas del inmueble influyen en el valor.', color: 'green' },
                        { text: 'La tasaci√≥n debe basarse en datos objetivos del mercado.', color: 'green' }
                    ],
                    tutor: 'Record√° que el procedimiento es t√©cnico y fundamentado.',
                    explanation: 'La tasaci√≥n urbana exige an√°lisis objetivo del mercado y caracter√≠sticas del inmueble para determinar valor.'
                }
            ],
            practica: [
                {
                    type: 'checklist',
                    badge: 'Relevamiento previo',
                    title: 'Datos necesarios para tasar',
                    instruction: 'Marc√° la informaci√≥n indispensable antes de iniciar una tasaci√≥n urbana.',
                    items: [
                        { text: 'Ubicaci√≥n exacta', correct: true },
                        { text: 'Preferencia del propietario', correct: false },
                        { text: 'Superficie del inmueble', correct: true },
                        { text: 'Estado de conservaci√≥n', correct: true }
                    ],
                    tutor: 'Pens√° en datos t√©cnicos verificables.',
                    explanation: 'La tasaci√≥n requiere datos objetivos como ubicaci√≥n, superficie y estado para determinar valor en el mercado.'
                },
                {
                    type: 'text',
                    badge: 'Ajuste por mercado',
                    title: 'Actualizaci√≥n del valor',
                    instruction: 'Explic√° por qu√© es necesario actualizar valores seg√∫n el contexto del mercado.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('mercado')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('actualizacion')) c++;
                        if (v.includes('deb')) c++;
                        if (v.includes('actualiz')) c++;
                        if (v.includes('context')) c++;
                        if (v.includes('ofert')) c++;
                        if (v.includes('demand')) c++;
                        if (v.includes('modific')) c++;
                        if (v.includes('estimacion')) c++;
                        return c >= 2;
                    },
                    tutor: 'Consider√° cambios en oferta y demanda.',
                    explanation: 'El valor debe actualizarse seg√∫n condiciones del mercado, ya que oferta y demanda modifican la estimaci√≥n.'
                },
                {
                    type: 'blanks',
                    badge: 'M√©todo comparativo',
                    title: 'Base del procedimiento',
                    instruction: 'Completar la frase.<br><br>La tasaci√≥n urbana se apoya en el an√°lisis de ________ similares vendidos recientemente.',
                    blanks: ['inmuebles'],
                    tutor: 'Pens√° en operaciones comparables.',
                    explanation: 'El m√©todo comparativo determina valor analizando inmuebles similares del mercado.'
                },
                {
                    type: 'traffic',
                    badge: 'Objetividad profesional',
                    title: 'Criterios en la valuaci√≥n',
                    instruction: 'Marca afirmaciones correctas sobre la pr√°ctica de tasaci√≥n',
                    items: [
                        { text: 'La tasaci√≥n puede basarse solo en la opini√≥n del cliente.', color: 'red' },
                        { text: 'El tasador debe actuar con independencia t√©cnica.', color: 'green' },
                        { text: 'El an√°lisis f√≠sico del inmueble es irrelevante.', color: 'red' },
                        { text: 'La comparaci√≥n de mercado es parte del procedimiento.', color: 'green' }
                    ],
                    tutor: 'Record√° que el procedimiento debe ser t√©cnico y objetivo.',
                    explanation: 'La pr√°ctica de tasaci√≥n exige independencia, an√°lisis del mercado y evaluaci√≥n f√≠sica del inmueble.'
                },
                {
                    type: 'text',
                    badge: 'Ubicaci√≥n estrat√©gica',
                    title: 'Impacto en el valor estimado',
                    instruction: 'Explic√° c√≥mo la ubicaci√≥n estrat√©gica puede modificar el valor de un inmueble urbano.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('ubicacion')) c++;
                        if (v.includes('demanda')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('estrategic')) c++;
                        if (v.includes('aument')) c++;
                        if (v.includes('elev')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en accesibilidad y servicios cercanos.',
                    explanation: 'Una ubicaci√≥n estrat√©gica aumenta la demanda y puede elevar el valor del inmueble en el mercado.'
                },
                {
                    type: 'checklist',
                    badge: 'Caracter√≠sticas t√©cnicas',
                    title: 'Variables determinantes',
                    instruction: 'Marc√° variables t√©cnicas que influyen directamente en la tasaci√≥n.',
                    items: [
                        { text: 'Calidad constructiva', correct: true },
                        { text: 'Antig√ºedad', correct: true },
                        { text: 'Gusto personal del tasador', correct: false },
                        { text: 'Servicios disponibles', correct: true }
                    ],
                    tutor: 'Consider√° elementos objetivos del inmueble.',
                    explanation: 'La tasaci√≥n analiza calidad constructiva, antig√ºedad y servicios para determinar valor real.'
                },
                {
                    type: 'text',
                    badge: 'Informe profesional',
                    title: 'Fundamentaci√≥n del valor',
                    instruction: 'Explic√° por qu√© el informe de tasaci√≥n debe incluir fundamentos claros.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('informe')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('fundamentacion')) c++;
                        if (v.includes('deb')) c++;
                        if (v.includes('inclu')) c++;
                        if (v.includes('analisis')) c++;
                        if (v.includes('caracteristic')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en respaldo t√©cnico.',
                    explanation: 'El informe debe fundamentar el valor con an√°lisis t√©cnico del mercado y caracter√≠sticas del inmueble.'
                },
                {
                    type: 'traffic',
                    badge: 'Mercado inmobiliario',
                    title: 'Influencia en la tasaci√≥n',
                    instruction: 'Marca afirmaciones correctas sobre mercado y valor',
                    items: [
                        { text: 'El mercado no afecta la tasaci√≥n.', color: 'red' },
                        { text: 'La oferta y la demanda influyen en el valor.', color: 'green' },
                        { text: 'Las operaciones recientes sirven como referencia.', color: 'green' },
                        { text: 'El valor es fijo e invariable.', color: 'red' }
                    ],
                    tutor: 'Analiz√° siempre el contexto del mercado.',
                    explanation: 'El valor depende del mercado, considerando oferta, demanda y operaciones recientes.'
                },
                {
                    type: 'text',
                    badge: 'Negociaci√≥n inmobiliaria',
                    title: 'Uso pr√°ctico de la tasaci√≥n',
                    instruction: 'Explic√° c√≥mo la tasaci√≥n sirve como herramienta en la negociaci√≥n.',
                    validation: (raw) => {
                        const v = normalizar(raw);
                        let c = 0;
                        if (v.includes('negociacion')) c++;
                        if (v.includes('valor')) c++;
                        if (v.includes('mercado')) c++;
                        if (v.includes('aport')) c++;
                        if (v.includes('objetiv')) c++;
                        if (v.includes('sirv')) c++;
                        if (v.includes('base')) c++;
                        if (v.includes('tecnic')) c++;
                        if (v.includes('negoci')) c++;
                        return c >= 2;
                    },
                    tutor: 'Pens√° en base objetiva de acuerdo.',
                    explanation: 'La tasaci√≥n aporta un valor objetivo que sirve como base t√©cnica para negociar dentro del mercado.'
                },
                {
                    type: 'checklist',
                    badge: 'Principios de la tasaci√≥n urbana',
                    title: 'Buenas pr√°cticas profesionales',
                    instruction: 'Marc√° buenas pr√°cticas en la tasaci√≥n urbana.',
                    items: [
                        { text: 'An√°lisis de mercado', correct: true },
                        { text: 'Comparaci√≥n objetiva', correct: true },
                        { text: 'Fundamentaci√≥n t√©cnica', correct: true },
                        { text: 'Determinaci√≥n arbitraria del valor', correct: false }
                    ],
                    tutor: 'Pens√° en procedimiento t√©cnico profesional.',
                    explanation: 'Las buenas pr√°cticas incluyen an√°lisis de mercado, comparaci√≥n objetiva y fundamentaci√≥n t√©cnica del valor.'
                }
            ]
        };

        let currentModule = '';
        let currentIndex = 0;
        let attemptCount = 0;
        let lastAudioModule = null;

        // ===== MAPEO DE M√ìDULOS A AUDIOS =====
        const moduloAudioMap = {
            'sintesis': 'mensaje1',
            'analisis': 'mensaje2',
            'escenarios': 'mensaje3',
            'practica': 'mensaje4'
        };

        function startModule(id) {
            playSound('click');
            currentModule = id;
            currentIndex = 0;
            attemptCount = 0;
            lastAudioModule = id;

            // Reproducir el audio del m√≥dulo correspondiente
            const audioKey = moduloAudioMap[id];
            if (audioKey) {
                playAudio(audioKey);
            }

            document.getElementById('selectionScreen').style.display = 'none';
            document.getElementById('activityScreen').classList.add('active');

            setTimeout(loadActivity, 300);
        }

        function loadActivity() {
            attemptCount = 0;

            if (currentIndex >= modules[currentModule].length) {
                // Reproducir "lolograste.mp3" al terminar TODAS las preguntas
                playAudio('lolograste');
                playSound('success');
                alert('¬°Excelente! Completaste este bloque.');
                setTimeout(() => {
                    location.reload();
                }, 2000);
                return;
            }

            const data = modules[currentModule][currentIndex];
            const container = document.getElementById('activityContainer');

            const msg = `Pregunta ${currentIndex + 1} de ${modules[currentModule].length}: ${data.tutor}`;
            document.getElementById('tutorMessage').innerText = msg;

            let html = `<span class="act-badge">${data.badge}</span>
                        <h2 class="act-title">${data.title}</h2>
                        <p class="act-instruction">${data.instruction}</p>`;

            if (data.type === 'text') {
                html += `<textarea id="txtInput" class="student-input" placeholder="Escribe tu respuesta con tus palabras..."></textarea>`;
            } else if (data.type === 'blanks') {
                html += `<div style="font-size:1.2rem; line-height:2.5;">`;
                data.blanks.forEach((b, i) => {
                    html += `${i + 1}. <input type="text" class="fill-input" data-ans="${b}"> <br>`;
                });
                html += `</div>`;
            } else if (data.type === 'traffic') {
                data.items.forEach((item, i) => {
                    html += `<div class="traffic-row" id="row-${i}">
                                <span>${item.text}</span>
                                <div style="display:flex; gap:10px;">
                                    <div class="traffic-btn bg-green" onclick="selTraffic(${i}, 'green')"></div>
                                    <div class="traffic-btn bg-yellow" onclick="selTraffic(${i}, 'yellow')"></div>
                                    <div class="traffic-btn bg-red" onclick="selTraffic(${i}, 'red')"></div>
                                </div>
                            </div>`;
                });
            } else if (data.type === 'checklist') {
                data.items.forEach((item) => {
                    html += `<div class="checklist-item" onclick="toggleCheck(this)" data-correct="${item.correct}">
                                <div class="check-box"></div>
                                <span>${item.text}</span>
                            </div>`;
                });
            }

            html += `<div id="feedback" class="feedback-area"></div>
                     <button id="btnCheck" class="btn-action" onclick="validate()">Verificar respuesta</button>
                     <button class="btn-action btn-back" onclick="location.reload()">Salir al men√∫</button>`;

            container.innerHTML = html;
            wireUiSounds();
        }

        let trafficAns = {};

        function selTraffic(idx, color) {
            trafficAns[idx] = color;
            const row = document.getElementById(`row-${idx}`);
            row.querySelectorAll('.traffic-btn').forEach(b => b.classList.remove('active'));
            row.querySelector(`.bg-${color}`).classList.add('active');
            playSound('click');
        }

        function toggleCheck(el) {
            el.classList.toggle('selected');
            el.querySelector('.check-box').innerText = el.classList.contains('selected') ? '‚úì' : '';

            if (el.classList.contains('selected')) {
                el.style.borderColor = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.background = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.borderColor = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.color = 'white';
            } else {
                el.style.borderColor = 'transparent';
                el.querySelector('.check-box').style.background = 'transparent';
                el.querySelector('.check-box').style.borderColor = '#ccc';
            }

            playSound('click');
        }

        function validate() {
            const data = modules[currentModule][currentIndex];
            const feedback = document.getElementById('feedback');
            let isCorrect = false;

            if (data.type === 'text') {
                const val = document.getElementById('txtInput').value;
                isCorrect = data.validation(val);
            } else if (data.type === 'blanks') {
                const inputs = document.querySelectorAll('.fill-input');
                let hits = 0;
                inputs.forEach(inp => {
                    const v = normalizar(inp.value);
                    const ans = normalizar(inp.dataset.ans);
                    if (v.length > 1 && ans.startsWith(v.slice(0, Math.max(2, Math.min(v.length, ans.length))))) hits++;
                });
                isCorrect = (hits === data.blanks.length);
            } else if (data.type === 'traffic') {
                let hits = 0;
                data.items.forEach((item, i) => { if (trafficAns[i] === item.color) hits++; });
                isCorrect = (hits === data.items.length);
            } else if (data.type === 'checklist') {
                let correct = true;
                document.querySelectorAll('.checklist-item').forEach(item => {
                    const sel = item.classList.contains('selected');
                    const should = item.dataset.correct === 'true';
                    if (sel !== should) correct = false;
                });
                isCorrect = correct;
            }

            feedback.style.display = 'block';

            if (isCorrect) {
                playAudio('correcto');
                playSound('success');
                feedback.className = 'feedback-area feedback-success';
                feedback.innerHTML = `<strong>¬°Muy bien!</strong><br>${data.explanation}`;
                document.getElementById('btnCheck').innerText = 'Siguiente pregunta ‚Üí';
                document.getElementById('btnCheck').onclick = () => { currentIndex++; loadActivity(); };
            } else {
                attemptCount++;

                if (attemptCount < 2) {
                    playAudio('error1');
                    feedback.className = 'feedback-area feedback-retry';
                    feedback.innerHTML = `<strong>Buen intento.</strong> Revis√° tu respuesta. Pista: ${data.tutor}`;
                } else {
                    playAudio('error2');
                    feedback.className = 'feedback-area feedback-fail';
                    feedback.innerHTML = `<strong>No pasa nada, aprendamos juntos:</strong><br>${data.explanation}`;
                    document.getElementById('btnCheck').innerText = 'Entendido, continuar ‚Üí';
                    document.getElementById('btnCheck').onclick = () => { currentIndex++; loadActivity(); };
                }
            }
        }

        function replayTutorMessage() {
            // Replay del √∫ltimo audio de m√≥dulo reproducido
            if (lastAudioModule) {
                const audioKey = moduloAudioMap[lastAudioModule];
                if (audioKey) {
                    playAudio(audioKey);
                }
            }
        }
    </script>
</body>
</html>